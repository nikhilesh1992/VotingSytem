CC = gcc
CFLAGS = -g -DRPC_SVC_FG
RPCGEN_FLAG = -C

all: server-rpc vote-count-rpc vote-rpc vote-zero-rpc add-voter-rpc list-candidates-rpc

# the executables: server-rpc vote-count-rpc vote-rpc vote-zero-rpc rpc-voter-rpc list-candidates-rpc

server-rpc: server-rpc.o rpc_svc.o  rpc_xdr.o
	$(CC) -o server-rpc server-rpc.o rpc_svc.o rpc_xdr.o -lnsl

vote-count-rpc: vote-count-rpc.o rpc_clnt.o rpc_xdr.o
	$(CC) -o vote-count-rpc vote-count-rpc.o rpc_clnt.o rpc_xdr.o -lnsl
	
vote-rpc: vote-rpc.o rpc_clnt.o rpc_xdr.o
	$(CC) -o vote-rpc vote-rpc.o rpc_clnt.o rpc_xdr.o -lnsl

vote-zero-rpc: vote-zero-rpc.o rpc_clnt.o rpc_xdr.o
	$(CC) -o vote-zero-rpc vote-zero-rpc.o rpc_clnt.o rpc_xdr.o -lnsl
	
add-voter-rpc: add-voter-rpc.o rpc_clnt.o rpc_xdr.o
	$(CC) -o add-voter-rpc add-voter-rpc.o rpc_clnt.o rpc_xdr.o -lnsl

list-candidates-rpc: list-candidates-rpc.o rpc_clnt.o rpc_xdr.o
	$(CC) -o list-candidates-rpc list-candidates-rpc.o rpc_clnt.o rpc_xdr.o -lnsl

# object files for the executables 

server-rpc.o: server-rpc.c rpc.h
	$(CC) $(CFLAGS) -c server-rpc.c

vote-count-rpc.o: vote-count-rpc.c rpc.h
	$(CC) $(CFLAGS) -c vote-count-rpc.c

vote-rpc.o: vote-rpc.c rpc.h
	$(CC) $(CFLAGS) -c vote-rpc.c
	
vote-zero-rpc.o: vote-zero-rpc.c rpc.h
	$(CC) $(CFLAGS) -c vote-zero-rpc.c

add-voter-rpc.o: add-voter-rpc.c rpc.h
	$(CC) $(CFLAGS) -c add-voter-rpc.c
	
list-candidates-rpc.o: list-candidates-rpc.c rpc.h
	$(CC) $(CFLAGS) -c list-candidates-rpc.c

# compile files generated by rpcgen

rpc_svc.o: rpc_svc.c rpc.h
	$(CC) $(CFLAGS) -c rpc_svc.c

rpc_clnt.o: rpc_clnt.c rpc.h
	$(CC) $(CFLAGS) -c rpc_clnt.c

rpc_xdr.o: rpc_xdr.c rpc.h
	$(CC) $(CFLAGS) -c rpc_xdr.c

# rpc.x produces rpc.h, rpc_clnt.c, rpc_svc.c, and rpc_xdr.c
# make sure we regenerate them if our interface (rpc.x) changes

rpc_clnt.c rpc_svc.c rpc_xdr.c rpc.h:	rpc.x
	rpcgen $(RPCGEN_FLAG) rpc.x

clean:
	rm -f server-rpc vote-count-rpc vote-rpc vote-zero-rpc add-voter-rpc list-candidates-rpc server-rpc.o vote-count-rpc.o vote-rpc.o vote-zero-rpc.o add-voter-rpc.o list-candidates-rpc.o rpc_clnt.* rpc_svc.* rpc.h